### TL;DR

- äº‹ä»¶å‚³éä¾åºåˆ†ç‚ºä¸‰å€‹éšæ®µï¼šæ•ç²ï¼ˆCapturingï¼‰ã€ç›®æ¨™ï¼ˆTargetï¼‰ã€å†’æ³¡ï¼ˆBubblingï¼‰ã€‚
- `event.stopPropagation` ç”¨ä¾†å–æ¶ˆäº‹ä»¶çš„å‚³éï¼Œ`event.preventDefault` å‰‡ç”¨ä¾†å–æ¶ˆç€è¦½å™¨é è¨­çš„è¡Œç‚ºã€‚
- `event.target` ç‚ºè§¸ç™¼äº‹ä»¶çš„å…ƒç´ ï¼Œ`event.currentTarget` ç‚ºäº‹ä»¶å‚³éæ™‚è§¸ç™¼äº‹ä»¶çš„å…ƒç´ ã€‚
- äº‹ä»¶ä»£ç†ï¼ˆevent delegationï¼‰æ˜¯é€éäº‹ä»¶å‚³éï¼ˆé€šå¸¸æ˜¯å†’æ³¡éšæ®µï¼‰ä¾†çµ±ä¸€è™•ç†ç›¸åŒçš„äº‹ä»¶ï¼Œæ¸›å°‘åœ¨ç›¸åŒå…ƒç´ ä¸ŠåŠ ä¸Šç›¸åŒäº‹ä»¶è™•ç†å™¨ã€‚

### äº‹ä»¶å‚³éçš„ä¸‰å€‹éšæ®µ

äº‹ä»¶å‚³éå¯ä»¥ä¾åºåˆ†ç‚ºä¸‰å€‹éšæ®µï¼š

1. æ•ç²ï¼ˆCapturingï¼‰ï¼šäº‹ä»¶ç”±**æ ¹å…ƒç´ å¾€ä¸‹å‚³é**ï¼Œç›´åˆ°æ‰¾åˆ°è§¸ç™¼äº‹ä»¶çš„å…ƒç´ ã€‚
2. ç›®æ¨™ï¼ˆTargetï¼‰ï¼šäº‹ä»¶æ‰¾åˆ°è§¸ç™¼äº‹ä»¶çš„å…ƒç´ ï¼Œä¸¦åŸ·è¡Œå…¶äº‹ä»¶è™•ç†å™¨ï¼ˆevent handlerï¼‰ã€‚
3. å†’æ³¡ï¼ˆBubblingï¼‰ï¼šäº‹ä»¶ç”±**è§¸ç™¼äº‹ä»¶çš„å…ƒç´ å¾€ä¸Šå‚³é**ï¼Œç›´åˆ°å›åˆ°æ ¹å…ƒç´ ã€‚

![eventflow.png](./eventflow.png)

### äº‹ä»¶æ•ç²ï¼ˆCapturingï¼‰

ç”±æ ¹å…ƒç´ å¾€ä¸‹æ‰¾ç›®æ¨™å…ƒç´ çš„éç¨‹ï¼Œç›¸è¼ƒæ–¼äº‹ä»¶å†’æ³¡ï¼Œäº‹ä»¶æ•ç²è¼ƒå°‘ä½¿ç”¨ã€‚

ç•¶ä½¿ç”¨ Â `addEventListener(event, handler)`Â  çš„æ™‚å€™ï¼Œ**é è¨­åªæœƒç›£è½äº‹ä»¶å‚³éä¸­çš„ç›®æ¨™å’Œå†’æ³¡éšæ®µ**ï¼Œå¦‚æœè¦ç›£è½æ•ç²éšæ®µï¼Œå°±å¿…é ˆåœ¨ Â `addEventListener()`Â  ä¸­è¨­å®šç¬¬ä¸‰å€‹åƒæ•¸ç‚º Â `true`ã€‚

```jsx
<body>
	 <button>button</button>
</body>

<script>
	const body = document.querySelector('body');
	const button = document.querySelector('button');

	body.addEventListener('click', function (e) {
		console.log('body');
	}, true);

	button.addEventListener('click', function (e) {
		console.log('button');
	}, true);

	// ç•¶ button è¢«é»æ“Šæ™‚ï¼Œç”±æ–¼ eventListener ç¬¬ä¸‰å€‹åƒæ•¸ç‚º trueï¼Œå› æ­¤æœƒç›£è½æ•ç²éšæ®µçš„äº‹ä»¶ï¼Œå› æ­¤ä¾åºå°å‡º body, button
</script>
```

### äº‹ä»¶å†’æ³¡ï¼ˆBubblingï¼‰

åœ¨ç›®æ¨™éšæ®µåŸ·è¡Œç›®æ¨™å…ƒç´ çš„äº‹ä»¶è™•ç†å™¨å¾Œï¼Œç”±ç›®æ¨™å…ƒç´ å¾€ä¸Šå‚³éè‡³æ ¹å…ƒç´ çš„éç¨‹ã€‚

```html
<body onclick="console.log('body')">
  <div onclick="console.log('div')">
    <button onclick="console.log('button')">button</button>
  </div>
</body>

// ç•¶ button è¢«é»æ“Šæ™‚ï¼Œä¾åºå°å‡º button div body
```

### å–æ¶ˆäº‹ä»¶å‚³é (event.stopPropagation)

åœ¨å¯¦å‹™ä¸Šï¼Œæˆ‘å€‘æœ‰æ™‚å€™ä¸æƒ³è¦äº‹ä»¶å‚³éçš„æ©Ÿåˆ¶ï¼Œåªæƒ³è¦ç›®æ¨™å…ƒç´ çš„äº‹ä»¶è¢«è§¸ç™¼ï¼Œä¸æƒ³è¦å…¶ä»–å…ƒç´ çš„äº‹ä»¶è¢«è§¸ç™¼ï¼Œé¿å…ç™¼ç”Ÿä¸€äº›é æœŸä»¥å¤–çš„è¡Œç‚ºã€‚é€™æ™‚å€™æˆ‘å€‘å°±å¯ä»¥åŠ ä¸Š `event.stopPropagation()`ä¾†å–æ¶ˆäº‹ä»¶çš„å‚³éã€‚

```jsx
<body>
	 <button>button</button>
</body>

<script>
	const body = document.querySelector('body');
	const button = document.querySelector('button');

	body.addEventListener('click', function (e) {
		console.log('body');
	});

	button.addEventListener('click', function (e) {
		e.stopPropagation();
		console.log('button');
	});

	// ç•¶ button è¢«é»æ“Šæ™‚ï¼Œç”±æ–¼ e.stopPropagationï¼Œäº‹ä»¶å°‡ä¸æœƒç¹¼çºŒå†’æ³¡ï¼Œå› æ­¤åªæœƒå°å‡º button
</script>
```

â—ï¸ ç‰¹åˆ¥éœ€è¦æ³¨æ„ç•¶åœ¨**æ•ç²éšæ®µå–æ¶ˆäº‹ä»¶å‚³é**æ™‚ï¼Œå¾ŒçºŒçš„ç›®æ¨™ã€å†’æ³¡éšæ®µçš†ä¸æœƒç™¼ç”Ÿ

```jsx
<body>
	 <button>button</button>
</body>

<script>
	const body = document.querySelector('body');
	const button = document.querySelector('button');

	body.addEventListener('click', function (e) {
		e.stopPropagation();
		console.log('capturing, body');
	}, true);

	button.addEventListener('click', function (e) {
		console.log('capturing, button');
	}, true);


	body.addEventListener('click', function (e) {
		console.log('body');
	});

	button.addEventListener('click', function (e) {
		console.log('button');
	});

	// ç•¶ button è¢«é»æ“Šæ™‚ï¼Œåªæœƒå°å‡º capturing, bodyï¼Œå› ç‚ºåœ¨æ•ç²éšæ®µå°±å–æ¶ˆäº‹ä»¶å¾€ä¸‹ç¹¼çºŒå‚³é
</script>
```

### å–æ¶ˆé è¨­è¡Œç‚º ï¼ˆevent.preventDefaultï¼‰

`event.preventDefault()` ç¶“å¸¸èˆ‡ `event.stopPropagation()` ææ··ï¼Œ`event.stopPropagation()` æ˜¯ç”¨ä¾†å–æ¶ˆäº‹ä»¶çš„å‚³éï¼Œè€Œ `event.preventDefault()` ä¸»è¦æ˜¯ç”¨ä¾†å–æ¶ˆé è¨­çš„ç€è¦½å™¨è¡Œç‚ºã€‚

å¦‚ä¸‹é¢ç¨‹å¼ç¢¼æ‰€ç¤ºï¼Œç•¶ä½¿ç”¨è€…é»æ“Š a æ¨™ç±¤çš„æ™‚å€™ï¼Œç€è¦½å™¨é è¨­çš„è¡Œç‚ºæ˜¯è·³è½‰åˆ°ä¸åŒçš„é é¢ï¼Œç„¶è€Œå¯ä»¥é€é`event.preventDefault()` ä¾†å–æ¶ˆ a æ¨™ç±¤è·³è½‰çš„é è¨­è¡Œç‚ºï¼Œä¾†åŸ·è¡Œé–‹ç™¼äººå“¡æƒ³è¦çš„è¡Œç‚ºã€‚

```jsx
const link = document.querySelector('a');

link.addEventListener('click', function (e) {
  e.preventDefault(); // å–æ¶ˆé è¨­è¡Œç‚º
  console.log('clicked'); // åŸ·è¡Œé–‹ç™¼äººå“¡æƒ³è¦çš„è¡Œç‚º
});
```

### event.target vs. event.currentTarget

- `event.target`ï¼šè§¸ç™¼æ­¤äº‹ä»¶çš„å…ƒç´ ï¼Œé€™å€‹å…ƒç´ åœ¨æ•´å€‹å†’æ³¡éç¨‹ä¸­ä¸æœƒæ”¹è®Šã€‚
- `event.currentTarget`ï¼šç¶å®šæ­¤äº‹ä»¶çš„å…ƒç´ ï¼Œå…ƒç´ æœƒéš¨è‘—äº‹ä»¶å‚³éæ”¹è®Šï¼Œé€šå¸¸å’Œ Â `this`Â  æŒ‡çš„æ˜¯åŒä¸€å€‹å…ƒç´ ã€‚

### äº‹ä»¶ä»£ç† ï¼ˆEvent Delegationï¼‰

ä¸€å®šæœ‰äººæœƒæƒ³ï¼Œæ•ç²äº‹ä»¶å’Œå†’æ³¡äº‹ä»¶åˆ°åº•æœ‰ä»€éº¼å¥½è™• ï¼Œæœ‰ä»€éº¼æ‡‰ç”¨å— ğŸ¤”

è©¦æƒ³ä¸€å€‹æƒ…å¢ƒï¼Œå‡è¨­åŒæ™‚æœ‰å¾ˆå¤šå…ƒç´ éƒ½éœ€è¦ç›¸åŒçš„äº‹ä»¶ç›£è½å™¨èˆ‡è™•ç†å™¨ï¼Œèˆ‡å…¶åœ¨æ¯å€‹å…ƒç´ ä¸€ä¸€åŠ ä¸Šé€™äº›è™•ç†å™¨ï¼Œä¸å¦‚**åˆ©ç”¨äº‹ä»¶å†’æ³¡çš„ç‰¹æ€§ï¼Œçµ±ä¸€åœ¨å®ƒå€‘çš„çˆ¶å±¤å…ƒç´ è™•ç†ï¼Œ**é€™å°±æ˜¯äº‹ä»¶ä»£ç†**ã€‚**

ğŸ’©Â  é»æ“Šæ¯å€‹ li å…ƒç´ å¾Œï¼Œéƒ½è¦é¡¯ç¤ºå…¶å°æ‡‰ `data-num` çš„å€¼

```html
<ol id="list">
  <li data-num="1" onclick="console.log(this.dataset.num)">1</li>
  <li data-num="2" onclick="console.log(this.dataset.num)">2</li>
  <li data-num="3" onclick="console.log(this.dataset.num)">3</li>
  <li data-num="4" onclick="console.log(this.dataset.num)">4</li>
</ol>
```

âœ…Â  åœ¨çˆ¶å±¤åŠ ä¸Šä¸€å€‹é»æ“Šäº‹ä»¶çš„äº‹ä»¶è™•ç†å™¨ï¼Œçµ±ä¸€è™•ç†ç›¸åŒçš„é‚è¼¯

```jsx
<ol id="list">
  <li data-num="1">1</li>
  <li data-num="2">2</li>
  <li data-num="3">3</li>
  <li data-num="4">4</li>
</ol>

<script>
	const list = document.getElementById('list')

	list.addEventListener('click', (e) => {
	  const li = e.target;

		// æª¢æŸ¥ li æ˜¯å¦åœ¨ list è£¡é¢
	  if (!li || !list.contains(li)) return;

	  console.log(li.dataset.num)
	});
</script>
```

åƒè€ƒä¾†æº:

1. [https://blog.techbridge.cc/2017/07/15/javascript-event-propagation/](https://blog.techbridge.cc/2017/07/15/javascript-event-propagation/)
2. [https://shubo.io/event-bubbling-event-capturing-event-delegation/](https://shubo.io/event-bubbling-event-capturing-event-delegation/)
3. [https://pjchender.dev/webapis/note-event-capturing-bubbling/](https://pjchender.dev/webapis/note-event-capturing-bubbling/)
